# Azure Kubernetes ë©€í‹° í´ëŸ¬ìŠ¤í„° ì•„í‚¤í…ì²˜

## ê°œìš”

ì´ ë¬¸ì„œëŠ” Azure í´ë¼ìš°ë“œì—ì„œ Kubernetes ë©€í‹°í´ëŸ¬ìŠ¤í„° í™˜ê²½ì„ êµ¬ì¶•í•˜ëŠ” ë°©ì•ˆì„ ì„¤ëª…í•©ë‹ˆë‹¤.
ì‹œì—° ë° ê°œë°œ ëª©ì ìœ¼ë¡œ ë¹„ìš© ìµœì í™”(Spot VM, ë¬´ë£Œ í‹°ì–´)ë¥¼ ê³ ë ¤í•œ êµ¬ì„±ì…ë‹ˆë‹¤.

### ëŒ€ìƒ í™˜ê²½ ë° ì›Œí¬ë¡œë“œ

| í•­ëª© | ê°’ |
|-----|-----|
| **í™˜ê²½ ìœ í˜•** | ì‹œì—°/ê°œë°œ/PoC (Azure Cloud) |
| **ì›Œí¬ë¡œë“œ ìœ í˜•** | Stateless (ì£¼), Stateful (ë³´ì¡°) |
| **í…Œë„Œì‹œ** | ë‹¨ì¼ (ë°ëª¨ í™˜ê²½) |
| **ë¦¬ì „** | Korea Central |

### SLO (Service Level Objectives)

| ì§€í‘œ | ì‹œì—° í™˜ê²½ | í”„ë¡œë•ì…˜ ê¶Œì¥ | ë¹„ê³  |
|-----|----------|-------------|------|
| **ê°€ìš©ì„±** | 95% | 99.9% | Spot VM íšŒìˆ˜ë¡œ ì¸í•œ ë‹¤ìš´íƒ€ì„ í—ˆìš© |
| **RTO** | 2ì‹œê°„ | 15ë¶„ | Terraform ì¬ë°°í¬ ê¸°ì¤€ |
| **RPO** | 24ì‹œê°„ | 1ì‹œê°„ | Velero ë°±ì—… ì£¼ê¸° |
| **API ì‘ë‹µ** | P99 < 1s | P99 < 200ms | ë‚´ë¶€ ì„œë¹„ìŠ¤ ê¸°ì¤€ |

#### Azure ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ SLA ì°¸ì¡°

| ì„œë¹„ìŠ¤ | SLA | ë¹„ê³  |
|-------|-----|------|
| **AKS Control Plane** | 99.95% (ìœ ë£Œ) / 99.5% (ë¬´ë£Œ) | ì‹œì—°ì€ ë¬´ë£Œ í‹°ì–´ ì‚¬ìš© |
| **Azure Key Vault** | 99.99% | ì‹œí¬ë¦¿ ì„œë¹„ìŠ¤ |
| **Azure Load Balancer** | 99.99% | Standard SKU |
| **Azure Disk (Premium)** | 99.9% | ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ VM |

> **ì‹œì—° í™˜ê²½ ì°¸ê³ **: Spot VM ì‚¬ìš©ìœ¼ë¡œ ì¸í•´ ì˜ˆê³  ì—†ì´ ë…¸ë“œê°€ íšŒìˆ˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ë¹„ìš© ìµœì í™”ë¥¼ ìœ„í•œ ì˜ë„ëœ íŠ¸ë ˆì´ë“œì˜¤í”„ì…ë‹ˆë‹¤.

---

## ì•„í‚¤í…ì²˜ ê²°ì • ê¸°ë¡ (ADR)

### ADR-A01: Spot VM ë°°ì¹˜ ì „ëµ (Tier ê¸°ë°˜)

| í•­ëª© | ë‚´ìš© |
|-----|------|
| **ìƒíƒœ** | Accepted |
| **ì»¨í…ìŠ¤íŠ¸** | Spot VMì€ 70% ì €ë ´í•˜ë‚˜ ì–¸ì œë“  íšŒìˆ˜(eviction) ê°€ëŠ¥ |
| **ê²°ì •** | ì›Œí¬ë¡œë“œë¥¼ Tier 0/1/2ë¡œ ë¶„ë¥˜í•˜ì—¬ ë°°ì¹˜ |
| **ì ìš© í™˜ê²½** | ğŸ¯ **ì‹œì—°/ê°œë°œ í™˜ê²½** - ë¹„ìš© ìµœì†Œí™” ìš°ì„  |

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì›Œí¬ë¡œë“œ Tier ë¶„ë¥˜ ë° ë°°ì¹˜ ì›ì¹™                           â”‚
â”‚                    âš ï¸  ì‹œì—°/ê°œë°œ í™˜ê²½ ê¸°ì¤€ (ë¹„ìš© ìµœì í™”)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Tier 0 (ì¤‘ë‹¨ ë¶ˆê°€):                                                        â”‚
â”‚    ì›Œí¬ë¡œë“œ: AKS Control Plane, Ingress Controller, CoreDNS                 â”‚
â”‚    ë°°ì¹˜: ì˜¨ë””ë§¨ë“œ System Node Pool                                          â”‚
â”‚    ì´ìœ : ì¥ì•  ì‹œ ì „ì²´ ì„œë¹„ìŠ¤ ë¶ˆê°€                                            â”‚
â”‚                                                                             â”‚
â”‚  Tier 1 (ì§§ì€ ì¤‘ë‹¨ í—ˆìš©, <5ë¶„):                                             â”‚
â”‚    ì›Œí¬ë¡œë“œ: ArgoCD, Prometheus, Vault Agent                                â”‚
â”‚    ë°°ì¹˜: ì‹œì—° â†’ Spot VM / í”„ë¡œë•ì…˜ â†’ ì˜¨ë””ë§¨ë“œ ê¶Œì¥                          â”‚
â”‚    ì´ìœ : í”Œë«í¼ í•µì‹¬ ì„œë¹„ìŠ¤, ë¹ ë¥¸ ë³µêµ¬ í•„ìš”                                  â”‚
â”‚                                                                             â”‚
â”‚  Tier 2 (ì¤‘ë‹¨ í—ˆìš©, <30ë¶„):                                                 â”‚
â”‚    ì›Œí¬ë¡œë“œ: ì• í”Œë¦¬ì¼€ì´ì…˜, ë°°ì¹˜ ì‘ì—…                                         â”‚
â”‚    ë°°ì¹˜: Spot Node Pool + PDB + PriorityClass                               â”‚
â”‚    ì´ìœ : ë¹„ìš© ìµœì í™”, ì¬ìŠ¤ì¼€ì¤„ë§ í—ˆìš©                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’¡ í”„ë¡œë•ì…˜ í™˜ê²½ ê¶Œì¥ì‚¬í•­                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tier 0/1 ì›Œí¬ë¡œë“œëŠ” ì˜¨ë””ë§¨ë“œ(On-Demand) ë…¸ë“œ í’€ì— ë°°ì¹˜í•˜ì—¬ ì•ˆì •ì„± í™•ë³´      â”‚
â”‚  - mgmt í´ëŸ¬ìŠ¤í„°: ì˜¨ë””ë§¨ë“œ ë…¸ë“œ ì‚¬ìš© ê¶Œì¥                                    â”‚
â”‚  - Spot VM íšŒìˆ˜ ì‹œ í”Œë«í¼ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ìœ¼ë¡œ ì „ì²´ ìš´ì˜ì— ì˜í–¥                   â”‚
â”‚  - ì˜ˆìƒ ì¶”ê°€ ë¹„ìš©: ~$50-80/ì›” (ì•ˆì •ì„± ëŒ€ë¹„ í•©ë¦¬ì )                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ADR-A02: CNI ì„ íƒ - Cilium BYO ê¸°ë³¸ì•ˆ

| í•­ëª© | ë‚´ìš© |
|-----|------|
| **ìƒíƒœ** | Accepted |
| **ì»¨í…ìŠ¤íŠ¸** | Azure CNI vs Cilium(BYO) ì„ íƒ í•„ìš” |
| **ê²°ì •** | **ê¸°ë³¸ì•ˆ: Cilium BYO CNI** (ë¡œì»¬ê³¼ ë™ì¼í•œ ë©€í‹°í´ëŸ¬ìŠ¤í„° ëª¨ë¸ ìœ ì§€) |
| **ëŒ€ì•ˆ** | Azure CNI (ìš´ì˜ í¸ì˜ì„± ìš°ì„  ì‹œ, ë³„ë„ ê°€ì´ë“œ ì œê³µ) |

| ë¹„êµ í•­ëª© | Cilium (BYO) - ê¸°ë³¸ì•ˆ | Azure CNI - ëŒ€ì•ˆ |
|----------|---------------------|-----------------|
| ë©€í‹°í´ëŸ¬ìŠ¤í„° | Cluster Mesh ì§€ì› | VNet Peeringë§Œ |
| ë„¤íŠ¸ì›Œí¬ ì •ì±… | Cilium Policy (L7 í¬í•¨) | Azure NPM (L4) |
| ê´€ì°°ì„± | Hubble í†µí•© | Azure Monitor ë³„ë„ |
| ë¡œì»¬ ì¼ê´€ì„± | âœ… ë†’ìŒ | âŒ ë‚®ìŒ |
| Azure ì§€ì› | ì œí•œì  (BYO) | âœ… ì™„ì „ |

#### Cilium BYO ìš´ì˜ ì œí•œ ì²´í¬ë¦¬ìŠ¤íŠ¸

> âš ï¸ **BYO CNIëŠ” Azure ê³µì‹ ì§€ì› ë²”ìœ„ ì™¸**ì…ë‹ˆë‹¤. ë‹¤ìŒ ì œí•œ ì‚¬í•­ì„ ìˆ™ì§€í•˜ì„¸ìš”.

| í•­ëª© | ì œí•œ ì‚¬í•­ | ëŒ€ì‘ ë°©ì•ˆ |
|-----|----------|----------|
| **AKS ì—…ê·¸ë ˆì´ë“œ** | CNIê°€ ìë™ ì—…ê·¸ë ˆì´ë“œë˜ì§€ ì•ŠìŒ | AKS ì—…ê·¸ë ˆì´ë“œ í›„ Cilium ìˆ˜ë™ ì¬ì„¤ì¹˜/ì—…ê·¸ë ˆì´ë“œ |
| **Azure ì§„ë‹¨** | `az aks` ë„¤íŠ¸ì›Œí¬ ì§„ë‹¨ ë¯¸ì§€ì› | `cilium connectivity test` ì‚¬ìš© |
| **Network Policy** | Azure NPMê³¼ í˜¼ìš© ë¶ˆê°€ | Cilium Policyë§Œ ì‚¬ìš© |
| **ì§€ì› í‹°ì¼“** | CNI ê´€ë ¨ ì´ìŠˆëŠ” MS ì§€ì› ì œì™¸ | Cilium ì»¤ë®¤ë‹ˆí‹°/Isovalent ì§€ì› |
| **ë…¸ë“œ ìŠ¤ì¼€ì¼ë§** | ìƒˆ ë…¸ë“œì— CNI ìë™ ì„¤ì¹˜ í•„ìš” | DaemonSetìœ¼ë¡œ ìë™ ì²˜ë¦¬ë¨ (í™•ì¸ í•„ìš”) |

### ADR-A03: ì¸ì¦/ì‹œí¬ë¦¿ ì•„í‚¤í…ì²˜ ì „í™˜

| í•­ëª© | ë‚´ìš© |
|-----|------|
| **ìƒíƒœ** | Accepted |
| **ì»¨í…ìŠ¤íŠ¸** | ë¡œì»¬ Vault â†’ Azure Key Vault ì „í™˜ ì‹œ ì‹ ë¢° ëª¨ë¸ ë³€ê²½ |
| **ê²°ì •** | Key Vault + External Secrets + Workload Identity ì‚¬ìš© |

```
ì‹ ë¢° ëª¨ë¸ ì°¨ì´:

ë¡œì»¬ (Vault):
  App â†’ K8s ServiceAccount â†’ Vault K8s Auth â†’ Secret

Azure (Key Vault):
  App â†’ K8s ServiceAccount â†’ Workload Identity â†’ AAD â†’ Key Vault

ì°¨ì´ì :
  - ì¸ì¦ ì²´ì¸ ê¸¸ì´ ì¦ê°€
  - AAD(Azure AD) ì˜ì¡´ì„± ì¶”ê°€
  - PKI ê¸°ëŠ¥: cert-manager + Let's Encrypt ë˜ëŠ” Azure CA ì‚¬ìš©
```

### ADR-A04: ê´€ì°°ì„± ì•„í‚¤í…ì²˜ ì„ íƒ

| í•­ëª© | ë‚´ìš© |
|-----|------|
| **ìƒíƒœ** | Accepted |
| **ì»¨í…ìŠ¤íŠ¸** | ê´€ë¦¬í˜•(Azure Monitor) vs ìì²´ í˜¸ìŠ¤íŒ…(Prometheus/Loki) |
| **ê²°ì •** | **ê¸°ë³¸ì•ˆ: Azure Monitor** (ì‹œì—°/ë¹„ìš© ìš°ì„ ) |
| **ëŒ€ì•ˆ** | Self-hosted (ë¡œì»¬ ì¼ê´€ì„± í•„ìš” ì‹œ) |

| ì˜µì…˜ | ì¥ì  | ë‹¨ì  |
|-----|------|------|
| **Azure Monitor (ê¸°ë³¸)** | ìš´ì˜ ë¶€ë‹´ ìµœì†Œ, 5GB/ì›” ë¬´ë£Œ | ë¡œì»¬ê³¼ ë‹¤ë¥¸ ì¿¼ë¦¬/ëŒ€ì‹œë³´ë“œ |
| **Self-hosted (ëŒ€ì•ˆ)** | ë¡œì»¬ê³¼ ë™ì¼í•œ ê²½í—˜ | ìš´ì˜ ë¶€ë‹´, ì¶”ê°€ ë¹„ìš© |

---

## ë¹„ìš© ìš”ì•½

> **ë¹„ìš© ê°€ì •**: Korea Central ë¦¬ì „, Standard_D2s_v3 VM, ì›” 730ì‹œê°„ ê¸°ì¤€, Egress 50GB/ì›”

| êµ¬ì„± | ì›” ì˜ˆìƒ ë¹„ìš© | ë¹„ê³  |
|------|------------|------|
| **Full Price** | ~$800-1000/ì›” | ì¼ë°˜ VM + ê´€ë¦¬í˜• ì„œë¹„ìŠ¤ |
| **Spot VM + ë¬´ë£Œ í‹°ì–´** | **~$50/ì›”** | ê¶Œì¥ (ì‹œì—°ìš©) |
| **Reserved Instance (1ë…„)** | ~$400/ì›” | ì¥ê¸° ìš´ì˜ ì‹œ |

**ë¹„ìš© ì ˆê° í•µì‹¬ ì „ëµ** (ì‹œì—°/ê°œë°œ í™˜ê²½):
- mgmt í´ëŸ¬ìŠ¤í„°: Spot VM 1ë…¸ë“œ (Tier 1 ì›Œí¬ë¡œë“œ, ë¹„ìš© ìµœì†Œí™”)
- app í´ëŸ¬ìŠ¤í„°: Spot VM 2ë…¸ë“œ (Tier 2 ì›Œí¬ë¡œë“œ)
- âš ï¸ **í”„ë¡œë•ì…˜ ê¶Œì¥**: mgmtëŠ” ì˜¨ë””ë§¨ë“œë¡œ ë³€ê²½ (ì•ˆì •ì„± í™•ë³´, +$50-80/ì›”)
- ë¹„ì—…ë¬´ì‹œê°„ ìë™ ì¤‘ì§€ (ì£¼ 40ì‹œê°„ ìš´ì˜ ì‹œ ~60% ì¶”ê°€ ì ˆê°)

---

## 1. ì•„í‚¤í…ì²˜ ë¹„êµ

### 1.1 ë¡œì»¬ vs Azure êµ¬ì„± ë¹„êµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        êµ¬ì„± ìš”ì†Œ ë§¤í•‘                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       ë¡œì»¬ (Multipass)       â”‚              Azure                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Multipass VM                â”‚ Azure VM (Spot Instance)                      â”‚
â”‚ kubeadm í´ëŸ¬ìŠ¤í„°            â”‚ AKS (Azure Kubernetes Service)                â”‚
â”‚ Cilium CNI                  â”‚ Azure CNI ë˜ëŠ” Cilium (BYO CNI)               â”‚
â”‚ MetalLB                     â”‚ Azure Load Balancer (ë‚´ì¥)                    â”‚
â”‚ Docker (ì™¸ë¶€ ì„œë¹„ìŠ¤)         â”‚ ACI / VM / Azure ê´€ë¦¬í˜• ì„œë¹„ìŠ¤                â”‚
â”‚ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€               â”‚ Azure Disk / Azure Files                      â”‚
â”‚ /etc/hosts                  â”‚ Azure Private DNS Zone                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Azure ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Azure Subscription                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Resource Group: rg-k8s-demo                       â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ VNet: vnet-k8s â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚                      10.0.0.0/8                               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚ Subnet-mgmt â”‚  â”‚ Subnet-app1 â”‚  â”‚ Subnet-app2 â”‚         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚ 10.1.0.0/16 â”‚  â”‚ 10.2.0.0/16 â”‚  â”‚ 10.3.0.0/16 â”‚         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚          â”‚                â”‚                â”‚                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  AKS-mgmt   â”‚  â”‚  AKS-app1   â”‚  â”‚  AKS-app2   â”‚         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  (Spot VM)  â”‚  â”‚  (Spot VM)  â”‚  â”‚  (Spot VM)  â”‚         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚  1 Node     â”‚  â”‚  2 Nodes    â”‚  â”‚  2 Nodes    â”‚         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚ âš¡Tier 1    â”‚  â”‚  Tier 2     â”‚  â”‚  Tier 2     â”‚         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚              Subnet-services: 10.4.0.0/24           â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚                                                     â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚   â”‚ Vault   â”‚  â”‚ ArgoCD  â”‚  â”‚ Harbor  â”‚            â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚   â”‚ (ACI)   â”‚  â”‚ (ACI)   â”‚  â”‚ (ACR)   â”‚            â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                               â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚                    ê³µìœ  ì„œë¹„ìŠ¤                                â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Azure Key Vault (ì‹œí¬ë¦¿)                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Azure Monitor (ëª¨ë‹ˆí„°ë§)                                 â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Azure Private DNS Zone (DNS)                            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Azure Container Registry (ì´ë¯¸ì§€)                        â”‚   â”‚   â”‚
â”‚  â”‚  â”‚   â€¢ Storage Account (ë°±ì—…/ìƒíƒœ)                              â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 ì¥ì•  ë„ë©”ì¸ ë° ê°€ìš©ì„±

> Azure ë¦¬ì „ ë‚´ ê°€ìš© ì˜ì—­(AZ) ë°°ì¹˜ ì „ëµ

#### ê°€ìš© ì˜ì—­(Availability Zone) ì„¤ê³„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Korea Central ë¦¬ì „ ê°€ìš© ì˜ì—­ ë°°ì¹˜                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Zone 1              Zone 2              Zone 3                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚ AKS-mgmtâ”‚        â”‚AKS-app1 â”‚        â”‚AKS-app2 â”‚                         â”‚
â”‚  â”‚ Node    â”‚        â”‚ Node 1  â”‚        â”‚ Node 1  â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ Node 2  â”‚        â”‚ Node 2  â”‚                         â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                             â”‚
â”‚  â€» ì‹œì—° í™˜ê²½: ë‹¨ì¼ Zone (ë¹„ìš© ìµœì†Œí™”)                                        â”‚
â”‚  â€» í”„ë¡œë•ì…˜: ë©€í‹° Zone ë¶„ì‚° ê¶Œì¥                                            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì¥ì•  ì˜í–¥ ë²”ìœ„ ë§¤íŠ¸ë¦­ìŠ¤ (Azure)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì¥ì•  ìœ í˜•       â”‚  ì˜í–¥ ë° ë³µêµ¬                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Spot VM íšŒìˆ˜    â”‚ âš ï¸ 30ì´ˆ ì „ ì•Œë¦¼ â†’ ë…¸ë“œ ë“œë ˆì¸ â†’ ìƒˆ Spot ë…¸ë“œ í”„ë¡œë¹„ì €ë‹    â”‚
â”‚ (Eviction)      â”‚ ì˜í–¥: í•´ë‹¹ ë…¸ë“œ Pod ì¬ìŠ¤ì¼€ì¤„ë§ (PDBë¡œ ìµœì†Œí™”)              â”‚
â”‚                 â”‚ ë³µêµ¬: ìë™ (Cluster Autoscaler)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ë‹¨ì¼ AZ ì¥ì•     â”‚ âŒ í•´ë‹¹ AZ ë…¸ë“œ ì „ì²´ ë‹¤ìš´                                  â”‚
â”‚                 â”‚ ì˜í–¥: ë©€í‹° AZ êµ¬ì„± ì‹œ ë‹¤ë¥¸ AZë¡œ í˜ì¼ì˜¤ë²„                   â”‚
â”‚                 â”‚ ë³µêµ¬: AZ ë³µêµ¬ ì‹œ ìë™ (ì‹œì—° í™˜ê²½ì€ ë‹¨ì¼ AZ)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AKS Control     â”‚ âœ… Azure ê´€ë¦¬ - SLA 99.95% (ìœ ë£Œ) / 99.5% (ë¬´ë£Œ)          â”‚
â”‚ Plane ì¥ì•       â”‚ ì˜í–¥: API Server ë¶ˆê°€, ê¸°ì¡´ ì›Œí¬ë¡œë“œëŠ” ê³„ì† ì‹¤í–‰           â”‚
â”‚                 â”‚ ë³µêµ¬: Azure ìë™ ë³µêµ¬                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Azure ë¦¬ì „ ì¥ì•  â”‚ âŒ ì „ì²´ í´ëŸ¬ìŠ¤í„° ë¶ˆê°€                                      â”‚
â”‚                 â”‚ ì˜í–¥: DR ë¦¬ì „ìœ¼ë¡œ ìˆ˜ë™ í˜ì¼ì˜¤ë²„ í•„ìš”                       â”‚
â”‚                 â”‚ ë³µêµ¬: Velero ë°±ì—…ìœ¼ë¡œ ë‹¤ë¥¸ ë¦¬ì „ì— ë³µì›                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Key Vault ì¥ì•   â”‚ âŒ ìƒˆ ì‹œí¬ë¦¿ ì¡°íšŒ ë¶ˆê°€                                     â”‚
â”‚                 â”‚ âœ… External Secrets ìºì‹œëœ ê°’ìœ¼ë¡œ ë™ì‘                     â”‚
â”‚                 â”‚ ë³µêµ¬: Azure ìë™ ë³µêµ¬ (SLA 99.99%)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Spot VM íšŒìˆ˜ ëŒ€ì‘

```yaml
# PodDisruptionBudget - Spot íšŒìˆ˜ ì‹œ ìµœì†Œ ê°€ìš©ì„± ë³´ì¥
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: app-pdb
spec:
  minAvailable: 1  # ìµœì†Œ 1ê°œ Pod ìœ ì§€
  selector:
    matchLabels:
      app: my-app
---
# Node ì¢…ë£Œ í•¸ë“¤ëŸ¬ (Azure ì¶”ì²œ)
# AKSì—ì„œ ìë™ ì„¤ì¹˜ë¨: azure-scheduled-events
# 30ì´ˆ ì „ ì•Œë¦¼ â†’ graceful shutdown
```

#### í”„ë¡œë•ì…˜ ê¶Œì¥: ë©€í‹° AZ êµ¬ì„±

```hcl
# Terraform - ë©€í‹° AZ ë…¸ë“œ í’€ (í”„ë¡œë•ì…˜)
resource "azurerm_kubernetes_cluster" "aks" {
  # ...

  default_node_pool {
    name                = "system"
    node_count          = 3
    vm_size             = "Standard_D2s_v3"
    zones               = ["1", "2", "3"]  # 3ê°œ AZ ë¶„ì‚°
    only_critical_addons_enabled = true
  }
}

resource "azurerm_kubernetes_cluster_node_pool" "user" {
  name                  = "user"
  kubernetes_cluster_id = azurerm_kubernetes_cluster.aks.id
  vm_size               = "Standard_D2s_v3"
  node_count            = 3
  zones                 = ["1", "2", "3"]  # 3ê°œ AZ ë¶„ì‚°
}
```

> **ì‹œì—° í™˜ê²½ ì°¸ê³ **: ë¹„ìš© ìµœì†Œí™”ë¥¼ ìœ„í•´ ë‹¨ì¼ Zoneì— ë°°ì¹˜í•©ë‹ˆë‹¤. í”„ë¡œë•ì…˜ì—ì„œëŠ” ë°˜ë“œì‹œ ë©€í‹° AZ êµ¬ì„±ì„ ì ìš©í•˜ì„¸ìš”.

---

## 2. ë¹„ìš© ìµœì í™” ì „ëµ

### 2.1 Spot VM í™œìš©

```hcl
# Terraform - AKS Spot Node Pool
resource "azurerm_kubernetes_cluster_node_pool" "spot" {
  name                  = "spot"
  kubernetes_cluster_id = azurerm_kubernetes_cluster.aks.id
  vm_size               = "Standard_D2s_v3"  # 2 vCPU, 8GB RAM
  node_count            = 2

  priority        = "Spot"
  eviction_policy = "Delete"
  spot_max_price  = 0.04  # ì‹œê°„ë‹¹ ìµœëŒ€ $0.04 (ì•½ 70% í• ì¸)

  node_labels = {
    "kubernetes.azure.com/scalesetpriority" = "spot"
  }

  node_taints = [
    "kubernetes.azure.com/scalesetpriority=spot:NoSchedule"
  ]
}
```

**Spot VM ê°€ê²© ë¹„êµ** (Korea Central ê¸°ì¤€):
| VM í¬ê¸° | ì¼ë°˜ ê°€ê²© | Spot ê°€ê²© | ì ˆê°ë¥  |
|---------|----------|----------|-------|
| Standard_D2s_v3 | $0.096/hr | $0.029/hr | 70% |
| Standard_D4s_v3 | $0.192/hr | $0.058/hr | 70% |

### 2.2 ë¬´ë£Œ í‹°ì–´ í™œìš©

| ì„œë¹„ìŠ¤ | ë¬´ë£Œ í‹°ì–´ ì¡°ê±´ | ì›” ì ˆê° |
|--------|---------------|---------|
| **AKS Control Plane** | í•­ìƒ ë¬´ë£Œ | ~$75 |
| **Azure Monitor** | 5GB/ì›” ë¡œê·¸ ë¬´ë£Œ | ~$20 |
| **Azure Key Vault** | 10,000 ì‘ì—…/ì›” | ~$10 |
| **Azure Container Registry** | Basic í‹°ì–´ ì œí•œì  ë¬´ë£Œ | ~$5 |

### 2.3 ì˜ˆìƒ ë¹„ìš© ìƒì„¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               ì›”ê°„ ì˜ˆìƒ ë¹„ìš© (Spot VM ê¸°ì¤€)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  AKS ë…¸ë“œ (Spot):                                              â”‚
â”‚    mgmt: 1x D2s_v3   = $0.029 Ã— 730h = $21.17                 â”‚
â”‚    app1: 2x D2s_v3   = $0.058 Ã— 730h = $42.34                 â”‚
â”‚    app2: 2x D2s_v3   = $0.058 Ã— 730h = $42.34                 â”‚
â”‚                                         â”€â”€â”€â”€â”€â”€â”€â”€â”€              â”‚
â”‚    ì†Œê³„: $105.85 (â†’ ì ˆì „ ëª¨ë“œë¡œ $35 ê°€ëŠ¥)                      â”‚
â”‚                                                                â”‚
â”‚  ìŠ¤í† ë¦¬ì§€:                                                      â”‚
â”‚    Azure Disk (Standard SSD): 3 Ã— 64GB = $7.68                â”‚
â”‚    Storage Account (Blob): ~10GB = $0.20                      â”‚
â”‚                                                                â”‚
â”‚  ë„¤íŠ¸ì›Œí¬:                                                      â”‚
â”‚    Load Balancer (Basic): ë¬´ë£Œ                                 â”‚
â”‚    Egress: ~50GB = $4.35                                      â”‚
â”‚                                                                â”‚
â”‚  ê´€ë¦¬í˜• ì„œë¹„ìŠ¤:                                                 â”‚
â”‚    AKS Control Plane: ë¬´ë£Œ                                     â”‚
â”‚    Key Vault: ë¬´ë£Œ (10K ops)                                   â”‚
â”‚    ACR Basic: $5/ì›”                                            â”‚
â”‚                                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â”‚
â”‚  ì´ê³„: ~$52/ì›” (ë¹„ì—…ë¬´ì‹œê°„ ì ˆì „ ì‹œ)                             â”‚
â”‚  ì´ê³„: ~$120/ì›” (24/7 ìš´ì˜ ì‹œ)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 ë¹„ì—…ë¬´ì‹œê°„ ì ˆì „ ìŠ¤í¬ë¦½íŠ¸

```bash
#!/bin/bash
# scripts/azure/auto-scale.sh

ACTION=$1  # start | stop

RESOURCE_GROUP="rg-k8s-demo"
CLUSTERS=("aks-mgmt" "aks-app1" "aks-app2")

case $ACTION in
  stop)
    echo "=== í´ëŸ¬ìŠ¤í„° ì¤‘ì§€ (ë¹„ìš© ì ˆê° ëª¨ë“œ) ==="
    for cluster in "${CLUSTERS[@]}"; do
      echo "ì¤‘ì§€: $cluster"
      az aks stop --name $cluster --resource-group $RESOURCE_GROUP --no-wait
    done
    ;;

  start)
    echo "=== í´ëŸ¬ìŠ¤í„° ì‹œì‘ ==="
    for cluster in "${CLUSTERS[@]}"; do
      echo "ì‹œì‘: $cluster"
      az aks start --name $cluster --resource-group $RESOURCE_GROUP --no-wait
    done
    ;;

  *)
    echo "ì‚¬ìš©ë²•: $0 [start|stop]"
    exit 1
    ;;
esac

# ìŠ¤ì¼€ì¤„ë§ (crontab ì˜ˆì‹œ):
# í‰ì¼ 9ì‹œ ì‹œì‘: 0 9 * * 1-5 /path/to/auto-scale.sh start
# í‰ì¼ 18ì‹œ ì¤‘ì§€: 0 18 * * 1-5 /path/to/auto-scale.sh stop
# ì£¼ë§ ì „ì²´ ì¤‘ì§€: 0 0 * * 0,6 /path/to/auto-scale.sh stop
```

---

## 3. Terraform êµ¬ì„±

### 3.1 í”„ë¡œì íŠ¸ êµ¬ì¡°

```
terraform-azure/
â”œâ”€â”€ main.tf                 # ë©”ì¸ êµ¬ì„±
â”œâ”€â”€ variables.tf            # ë³€ìˆ˜ ì •ì˜
â”œâ”€â”€ outputs.tf              # ì¶œë ¥ ì •ì˜
â”œâ”€â”€ providers.tf            # í”„ë¡œë°”ì´ë” ì„¤ì •
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ aks/                # AKS í´ëŸ¬ìŠ¤í„° ëª¨ë“ˆ
â”‚   â”‚   â”œâ”€â”€ main.tf
â”‚   â”‚   â”œâ”€â”€ variables.tf
â”‚   â”‚   â””â”€â”€ outputs.tf
â”‚   â”œâ”€â”€ networking/         # VNet, Subnet ëª¨ë“ˆ
â”‚   â””â”€â”€ services/           # ê³µìœ  ì„œë¹„ìŠ¤ ëª¨ë“ˆ
â””â”€â”€ environments/
    â”œâ”€â”€ dev.tfvars          # ê°œë°œ í™˜ê²½ ë³€ìˆ˜
    â””â”€â”€ prod.tfvars         # ìš´ì˜ í™˜ê²½ ë³€ìˆ˜
```

### 3.2 ë©”ì¸ Terraform ì„¤ì •

```hcl
# providers.tf
terraform {
  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 3.90"
    }
  }

  backend "azurerm" {
    resource_group_name  = "rg-terraform-state"
    storage_account_name = "stterraformstate"
    container_name       = "tfstate"
    key                  = "k8s-demo.tfstate"
  }
}

provider "azurerm" {
  features {}
}

# main.tf
locals {
  location = "koreacentral"
  tags = {
    Environment = var.environment
    Project     = "k8s-demo"
    ManagedBy   = "terraform"
  }
}

# ë¦¬ì†ŒìŠ¤ ê·¸ë£¹
resource "azurerm_resource_group" "main" {
  name     = "rg-k8s-demo-${var.environment}"
  location = local.location
  tags     = local.tags
}

# VNet
resource "azurerm_virtual_network" "main" {
  name                = "vnet-k8s-${var.environment}"
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name
  address_space       = ["10.0.0.0/8"]
  tags                = local.tags
}

# Subnet - mgmt í´ëŸ¬ìŠ¤í„°
resource "azurerm_subnet" "mgmt" {
  name                 = "subnet-mgmt"
  resource_group_name  = azurerm_resource_group.main.name
  virtual_network_name = azurerm_virtual_network.main.name
  address_prefixes     = ["10.1.0.0/16"]
}

# Subnet - app1 í´ëŸ¬ìŠ¤í„°
resource "azurerm_subnet" "app1" {
  name                 = "subnet-app1"
  resource_group_name  = azurerm_resource_group.main.name
  virtual_network_name = azurerm_virtual_network.main.name
  address_prefixes     = ["10.2.0.0/16"]
}

# Subnet - app2 í´ëŸ¬ìŠ¤í„°
resource "azurerm_subnet" "app2" {
  name                 = "subnet-app2"
  resource_group_name  = azurerm_resource_group.main.name
  virtual_network_name = azurerm_virtual_network.main.name
  address_prefixes     = ["10.3.0.0/16"]
}
```

### 3.3 AKS í´ëŸ¬ìŠ¤í„° ëª¨ë“ˆ

> **ADR-A01 ì°¸ì¡°**: ì‹œì—° í™˜ê²½ì—ì„œëŠ” ëª¨ë“  í´ëŸ¬ìŠ¤í„° Spot VM ì‚¬ìš© (ë¹„ìš© ìµœì†Œí™”)
> âš ï¸ **í”„ë¡œë•ì…˜ ê¶Œì¥**: mgmtëŠ” ì˜¨ë””ë§¨ë“œë¡œ ë³€ê²½í•˜ì—¬ í”Œë«í¼ ì•ˆì •ì„± í™•ë³´

#### AKS í‹°ì–´ ì´ì›í™” ì „ëµ

| í´ëŸ¬ìŠ¤í„° | SKU Tier | ì´ìœ  | ì›” ì¶”ê°€ ë¹„ìš© |
|---------|----------|------|-------------|
| **mgmt** | Free | ì‹œì—° í™˜ê²½, SLA ë¶ˆí•„ìš” | $0 |
| **app1/app2** | Free | ì›Œí¬ë¡œë“œ í´ëŸ¬ìŠ¤í„° | $0 |
| **(ìš´ì˜ ì‹œ)** | Standard | API ì„œë²„ 99.9% SLA | +$73/í´ëŸ¬ìŠ¤í„° |

```hcl
# modules/aks/main.tf
resource "azurerm_kubernetes_cluster" "main" {
  name                = var.cluster_name
  location            = var.location
  resource_group_name = var.resource_group_name
  dns_prefix          = var.cluster_name
  kubernetes_version  = var.kubernetes_version

  # AKS í‹°ì–´ (ì‹œì—°: Free, ìš´ì˜: Standard)
  sku_tier = var.is_production ? "Standard" : "Free"

  default_node_pool {
    name                = "system"
    node_count          = 1
    vm_size             = "Standard_D2s_v3"
    vnet_subnet_id      = var.subnet_id
    os_disk_size_gb     = 64
    os_disk_type        = "Managed"

    # ì‹œì—° í™˜ê²½: System ë…¸ë“œ í’€ë„ Spot VM ì‚¬ìš© (ë¹„ìš© ìµœì†Œí™”)
    # í”„ë¡œë•ì…˜ ê¶Œì¥: Spot ì„¤ì • ì œê±°í•˜ì—¬ ì˜¨ë””ë§¨ë“œë¡œ ë³€ê²½ (ì•ˆì •ì„±)
  }

  identity {
    type = "SystemAssigned"
  }

  # CNI ì„ íƒ (ADR-A02: Cilium BYO ê¸°ë³¸)
  network_profile {
    network_plugin    = var.use_cilium ? "none" : "azure"  # none = BYO CNI
    network_policy    = var.use_cilium ? null : "azure"
    load_balancer_sku = "basic"  # ë¬´ë£Œ
    outbound_type     = "loadBalancer"
  }

  tags = var.tags
}

# Spot ë…¸ë“œ í’€ (ì›Œì»¤)
resource "azurerm_kubernetes_cluster_node_pool" "spot" {
  count                 = var.use_spot ? 1 : 0
  name                  = "spot"
  kubernetes_cluster_id = azurerm_kubernetes_cluster.main.id
  vm_size               = var.spot_vm_size
  node_count            = var.spot_node_count
  vnet_subnet_id        = var.subnet_id

  priority        = "Spot"
  eviction_policy = "Delete"
  spot_max_price  = var.spot_max_price

  node_labels = {
    "kubernetes.azure.com/scalesetpriority" = "spot"
    "workload-type"                         = "application"
  }

  node_taints = [
    "kubernetes.azure.com/scalesetpriority=spot:NoSchedule"
  ]

  tags = var.tags
}
```

#### Spot ë…¸ë“œì—ì„œ ì›Œí¬ë¡œë“œ ë³´í˜¸ (PDB + PriorityClass)

```yaml
# Tier 2 ì›Œí¬ë¡œë“œìš© PriorityClass
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: spot-workload
value: 100
globalDefault: false
description: "Spot ë…¸ë“œì—ì„œ ì‹¤í–‰ë˜ëŠ” ì›Œí¬ë¡œë“œ (eviction í—ˆìš©)"
---
# Tier 1 ì›Œí¬ë¡œë“œìš© PriorityClass (Spotì—ì„œ ë³´í˜¸)
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: critical-workload
value: 1000
globalDefault: false
description: "ì¤‘ìš” ì›Œí¬ë¡œë“œ - eviction ì‹œ ìš°ì„  ìœ ì§€"
---
# PodDisruptionBudget ì˜ˆì‹œ
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: app-pdb
spec:
  minAvailable: 1  # ìµœì†Œ 1ê°œ Pod ìœ ì§€
  selector:
    matchLabels:
      app: my-app
```

### 3.4 ë³€ìˆ˜ ì •ì˜

```hcl
# variables.tf
variable "environment" {
  description = "í™˜ê²½ (dev, staging, prod)"
  type        = string
  default     = "dev"
}

variable "kubernetes_version" {
  description = "Kubernetes ë²„ì „"
  type        = string
  default     = "1.35.0"  # ë˜ëŠ” ì§€ì›ë˜ëŠ” ìµœì‹  ë²„ì „
}

variable "clusters" {
  description = "í´ëŸ¬ìŠ¤í„° ì„¤ì •"
  type = map(object({
    node_count     = number
    spot_node_count = number
    vm_size        = string
    spot_max_price = number
  }))
  default = {
    mgmt = {
      node_count      = 1
      spot_node_count = 0
      vm_size         = "Standard_D2s_v3"
      spot_max_price  = 0.04
    }
    app1 = {
      node_count      = 1
      spot_node_count = 2
      vm_size         = "Standard_D2s_v3"
      spot_max_price  = 0.04
    }
    app2 = {
      node_count      = 1
      spot_node_count = 2
      vm_size         = "Standard_D2s_v3"
      spot_max_price  = 0.04
    }
  }
}

# Azure Container Registry
variable "acr_sku" {
  description = "ACR SKU"
  type        = string
  default     = "Basic"  # Basic: $5/ì›”
}
```

---

## 4. ì„œë¹„ìŠ¤ ë§¤í•‘

> **ADR-A03, A04 ì°¸ì¡°**: ì„œë¹„ìŠ¤ ëŒ€ì²´ ì‹œ ê¸°ëŠ¥ ì°¨ì´ë¥¼ ë°˜ë“œì‹œ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.

### 4.1 ë¡œì»¬ â†’ Azure ì„œë¹„ìŠ¤ ë§¤í•‘ (ê¸°ëŠ¥ ì°¨ì´ í¬í•¨)

| ë¡œì»¬ ì„œë¹„ìŠ¤ | Azure ëŒ€ì•ˆ | ê¸°ëŠ¥ ì°¨ì´ |
|------------|-----------|----------|
| **Vault** | Azure Key Vault | âš ï¸ PKI ê¸°ëŠ¥ ì—†ìŒ â†’ cert-manager + Let's Encrypt ë³„ë„ êµ¬ì„± í•„ìš” |
| **ArgoCD** | AKS ë‚´ ë°°í¬ | âœ… ë™ì¼ (GitOps ìœ ì§€) |
| **Harbor** | ACR (Basic $5/ì›”) | âš ï¸ ì·¨ì•½ì  ìŠ¤ìº”ì€ Standard í‹°ì–´ í•„ìš” |
| **Nexus** | Azure Artifacts | âš ï¸ Maven/npmë§Œ ì§€ì›, Docker í”„ë¡ì‹œ ë¶ˆê°€ |
| **Prometheus** | Azure Monitor | âš ï¸ PromQL ë‹¤ë¦„, ê¸°ì¡´ ëŒ€ì‹œë³´ë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ í•„ìš” |
| **Grafana** | Azure Managed Grafana | âœ… ìœ ì‚¬ (Azure ë°ì´í„°ì†ŒìŠ¤ ìë™ ì—°ë™) |
| **cert-manager** | Key Vault CSI Driver | âš ï¸ ìë™ ê°±ì‹  ë°©ì‹ ë‹¤ë¦„, Vault PKI ëŒ€ì²´ í•„ìš” |
| **MetalLB** | Azure LB (ë‚´ì¥) | âœ… ìë™ í”„ë¡œë¹„ì €ë‹ |
| **Cilium** | Cilium BYO (ê¸°ë³¸) | âœ… ë™ì¼ (ADR-A02 ì°¸ì¡°) |

### 4.1.1 Vault â†’ Key Vault ì „í™˜ ì‹œ ì•„í‚¤í…ì²˜ ë³€ê²½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Vault â†’ Key Vault ì „í™˜ ì˜í–¥                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  [PKI/ì¸ì¦ì„œ]                                                               â”‚
â”‚  ë¡œì»¬: Vault PKI â†’ cert-manager â†’ ì¸ì¦ì„œ ìë™ ë°œê¸‰/ê°±ì‹                      â”‚
â”‚  Azure: cert-manager + Let's Encrypt (ë˜ëŠ” Azure CA) â†’ ì¸ì¦ì„œ ë°œê¸‰          â”‚
â”‚         âš ï¸ ë‚´ë¶€ CAê°€ í•„ìš”í•˜ë©´ Azure CA ë˜ëŠ” Self-signed ì‚¬ìš©                â”‚
â”‚                                                                             â”‚
â”‚  [ì‹œí¬ë¦¿ ë™ê¸°í™”]                                                            â”‚
â”‚  ë¡œì»¬: External Secrets â†’ Vault â†’ K8s Secret                               â”‚
â”‚  Azure: External Secrets â†’ Key Vault (AAD ì¸ì¦) â†’ K8s Secret               â”‚
â”‚         âš ï¸ Workload Identity ì„¤ì • í•„ìˆ˜                                      â”‚
â”‚                                                                             â”‚
â”‚  [ë™ì  ì‹œí¬ë¦¿]                                                              â”‚
â”‚  ë¡œì»¬: Vault Dynamic Secrets (DB ìê²©ì¦ëª… ìë™ ìƒì„±)                        â”‚
â”‚  Azure: âŒ ë¯¸ì§€ì› â†’ ìˆ˜ë™ ê´€ë¦¬ ë˜ëŠ” Azure SQL AAD ì¸ì¦ ì‚¬ìš©                  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Azure Key Vault ì—°ë™ (Vault ëŒ€ì²´)

> **ADR-A03 ì°¸ì¡°**: ì¸ì¦ ë°©ì‹ì€ **Workload Identity (ê¸°ë³¸ì•ˆ)** ë˜ëŠ” Managed Identity (ëŒ€ì•ˆ) ì„ íƒ

#### ì˜µì…˜ A: Workload Identity (ê¸°ë³¸ì•ˆ - ê¶Œì¥)

```yaml
# 1. AKSì—ì„œ Workload Identity í™œì„±í™” (Terraform)
# azurerm_kubernetes_clusterì— ì¶”ê°€:
#   workload_identity_enabled = true
#   oidc_issuer_enabled       = true

# 2. SecretProviderClass - Workload Identity ë°©ì‹
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: azure-kv-secrets
spec:
  provider: azure
  parameters:
    clientID: "<WORKLOAD_IDENTITY_CLIENT_ID>"  # Federated Credential
    keyvaultName: "kv-k8s-demo"
    tenantId: "<TENANT_ID>"
    objects: |
      array:
        - |
          objectName: db-password
          objectType: secret
---
# 3. Podì— ServiceAccount ì—°ê²°
apiVersion: v1
kind: Pod
metadata:
  name: app-pod
  labels:
    azure.workload.identity/use: "true"  # Workload Identity í™œì„±í™”
spec:
  serviceAccountName: workload-identity-sa  # Federated SA
  containers:
  - name: app
    image: myapp:latest
    volumeMounts:
    - name: secrets-store
      mountPath: "/mnt/secrets"
      readOnly: true
  volumes:
  - name: secrets-store
    csi:
      driver: secrets-store.csi.k8s.io
      readOnly: true
      volumeAttributes:
        secretProviderClass: azure-kv-secrets
```

#### ì˜µì…˜ B: Managed Identity (ëŒ€ì•ˆ - ë ˆê±°ì‹œ í˜¸í™˜)

```yaml
# VM Managed Identity ë°©ì‹ (AKS ë…¸ë“œì— ì§ì ‘ í• ë‹¹)
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: azure-kv-secrets-legacy
spec:
  provider: azure
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    userAssignedIdentityID: "<MANAGED_IDENTITY_CLIENT_ID>"
    keyvaultName: "kv-k8s-demo"
    tenantId: "<TENANT_ID>"
    objects: |
      array:
        - |
          objectName: db-password
          objectType: secret
```

| ë°©ì‹ | ì¥ì  | ë‹¨ì  |
|-----|------|------|
| **Workload Identity (ê¸°ë³¸)** | Podë³„ ì„¸ë¶„í™”ëœ ê¶Œí•œ, Azure ê¶Œì¥ | ì„¤ì • ë³µì¡ |
| **Managed Identity (ëŒ€ì•ˆ)** | ì„¤ì • ë‹¨ìˆœ | ë…¸ë“œ ì „ì²´ì— ê¶Œí•œ ë¶€ì—¬ |

### 4.3 Azure Monitor ì—°ë™ (Prometheus ëŒ€ì²´)

#### ê´€ì°°ì„± ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Azure ê´€ì°°ì„± ë°ì´í„° íë¦„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  AKS-mgmt   â”‚    â”‚  AKS-app1   â”‚    â”‚  AKS-app2   â”‚                     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚
â”‚  â”‚  â”‚OMS    â”‚  â”‚    â”‚  â”‚OMS    â”‚  â”‚    â”‚  â”‚OMS    â”‚  â”‚                     â”‚
â”‚  â”‚  â”‚Agent  â”‚  â”‚    â”‚  â”‚Agent  â”‚  â”‚    â”‚  â”‚Agent  â”‚  â”‚                     â”‚
â”‚  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â”‚                  â”‚                  â”‚                             â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                            â–¼                                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚              â”‚  Log Analytics Workspace â”‚                                   â”‚
â”‚              â”‚  (Container Insights)    â”‚                                   â”‚
â”‚              â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                                   â”‚
â”‚              â”‚  â€¢ ì»¨í…Œì´ë„ˆ ë©”íŠ¸ë¦­       â”‚                                   â”‚
â”‚              â”‚  â€¢ ì»¨í…Œì´ë„ˆ ë¡œê·¸         â”‚                                   â”‚
â”‚              â”‚  â€¢ K8s ì´ë²¤íŠ¸           â”‚                                   â”‚
â”‚              â”‚  â€¢ ë…¸ë“œ ì„±ëŠ¥            â”‚                                   â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                          â”‚                                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚         â–¼                â–¼                â–¼                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚  Grafana   â”‚  â”‚ Azure Monitor  â”‚  â”‚  Alert   â”‚                          â”‚
â”‚  â”‚ (Optional) â”‚  â”‚   Dashboard    â”‚  â”‚  Rules   â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ë¹„ìš© ê´€ë¦¬ ì „ëµ (Log Analytics)

| í•­ëª© | ì„¤ì • | ë¹„ìš© ì˜í–¥ |
|-----|------|----------|
| **ë³´ì¡´ ê¸°ê°„** | 30ì¼ (ê¸°ë³¸ ë¬´ë£Œ) | 30ì¼ ì´ˆê³¼ ì‹œ GBë‹¹ ê³¼ê¸ˆ |
| **ìˆ˜ì§‘ ì œí•œ** | ì¼ì¼ 5GB ì œí•œ ì„¤ì • | ì˜ˆìƒì¹˜ ëª»í•œ ë¹„ìš© ë°©ì§€ |
| **ìƒ˜í”Œë§** | ContainerLogV2 ì‚¬ìš© | ë¡œê·¸ ë³¼ë¥¨ ê°ì†Œ |
| **í•„í„°ë§** | ë¶ˆí•„ìš” ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì œì™¸ | kube-system ë¡œê·¸ ìµœì†Œí™” |

```bash
# Log Analytics ì¼ì¼ ìˆ˜ì§‘ ì œí•œ ì„¤ì •
az monitor log-analytics workspace update \
  --resource-group rg-k8s-demo \
  --workspace-name law-k8s-demo \
  --quota 5  # 5GB/ì¼
```

#### Terraform êµ¬ì„±

```hcl
# AKSì—ì„œ Azure Monitor í™œì„±í™”
resource "azurerm_kubernetes_cluster" "main" {
  # ... ê¸°ì¡´ ì„¤ì • ...

  oms_agent {
    log_analytics_workspace_id = azurerm_log_analytics_workspace.main.id
  }
}

resource "azurerm_log_analytics_workspace" "main" {
  name                = "law-k8s-demo"
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name
  sku                 = "PerGB2018"
  retention_in_days   = 30  # 30ì¼ ë¬´ë£Œ

  tags = local.tags
}

# Container Insights í™œì„±í™”
resource "azurerm_log_analytics_solution" "containers" {
  solution_name         = "ContainerInsights"
  location              = azurerm_resource_group.main.location
  resource_group_name   = azurerm_resource_group.main.name
  workspace_resource_id = azurerm_log_analytics_workspace.main.id
  workspace_name        = azurerm_log_analytics_workspace.main.name

  plan {
    publisher = "Microsoft"
    product   = "OMSGallery/ContainerInsights"
  }
}
```

---

## 5. ë°°í¬ ê°€ì´ë“œ

### 5.1 ì‚¬ì „ ìš”êµ¬ì‚¬í•­

```bash
# Azure CLI ì„¤ì¹˜
brew install azure-cli

# Azure ë¡œê·¸ì¸
az login

# êµ¬ë… ì„¤ì •
az account set --subscription "<SUBSCRIPTION_ID>"

# Terraform ì„¤ì¹˜
brew install terraform

# kubectl ì„¤ì¹˜
brew install kubectl
```

### 5.2 Terraform ì´ˆê¸°í™” ë° ë°°í¬

```bash
# 1. ë°±ì—”ë“œìš© ìŠ¤í† ë¦¬ì§€ ìƒì„± (ìµœì´ˆ 1íšŒ)
az group create -n rg-terraform-state -l koreacentral
az storage account create -n stterraformstate -g rg-terraform-state -l koreacentral --sku Standard_LRS
az storage container create -n tfstate --account-name stterraformstate

# 2. Terraform ì´ˆê¸°í™”
cd terraform-azure
terraform init

# 3. ê³„íš í™•ì¸
terraform plan -var-file=environments/dev.tfvars

# 4. ë°°í¬
terraform apply -var-file=environments/dev.tfvars -auto-approve

# 5. kubeconfig ê°€ì ¸ì˜¤ê¸°
az aks get-credentials --resource-group rg-k8s-demo-dev --name aks-mgmt --file ./kubeconfigs/mgmt.conf
az aks get-credentials --resource-group rg-k8s-demo-dev --name aks-app1 --file ./kubeconfigs/app1.conf
az aks get-credentials --resource-group rg-k8s-demo-dev --name aks-app2 --file ./kubeconfigs/app2.conf
```

### 5.3 ArgoCD ë°°í¬ (AKS ë‚´)

```bash
# mgmt í´ëŸ¬ìŠ¤í„°ì— ArgoCD ì„¤ì¹˜
export KUBECONFIG=./kubeconfigs/mgmt.conf

# ArgoCD ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±
kubectl create namespace argocd

# ArgoCD ì„¤ì¹˜
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

# LoadBalancerë¡œ ë…¸ì¶œ
kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'

# ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ í™•ì¸
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
```

---

## 6. ë©€í‹° í´ëŸ¬ìŠ¤í„° ì—°ê²°

### 6.1 VNet Peering ì„¤ì •

```hcl
# í´ëŸ¬ìŠ¤í„° ê°„ VNet Peering (ë‹¨ì¼ VNet ë‚´ ì„œë¸Œë„·ì´ë©´ ë¶ˆí•„ìš”)
# ë³„ë„ VNet ì‚¬ìš© ì‹œì—ë§Œ í•„ìš”

resource "azurerm_virtual_network_peering" "mgmt_to_app1" {
  name                      = "mgmt-to-app1"
  resource_group_name       = azurerm_resource_group.main.name
  virtual_network_name      = azurerm_virtual_network.mgmt.name
  remote_virtual_network_id = azurerm_virtual_network.app1.id
  allow_forwarded_traffic   = true
}
```

### 6.2 ArgoCD ë©€í‹° í´ëŸ¬ìŠ¤í„° ê´€ë¦¬

```bash
# ArgoCDì— app1, app2 í´ëŸ¬ìŠ¤í„° ë“±ë¡
argocd login <ARGOCD_SERVER> --username admin --password <PASSWORD>

# app1 í´ëŸ¬ìŠ¤í„° ì¶”ê°€
argocd cluster add aks-app1 --kubeconfig ./kubeconfigs/app1.conf

# app2 í´ëŸ¬ìŠ¤í„° ì¶”ê°€
argocd cluster add aks-app2 --kubeconfig ./kubeconfigs/app2.conf

# ë“±ë¡ëœ í´ëŸ¬ìŠ¤í„° í™•ì¸
argocd cluster list
```

### 6.3 Azure Private DNS Zone

```hcl
# Private DNS Zone
resource "azurerm_private_dns_zone" "main" {
  name                = "k8s.internal"
  resource_group_name = azurerm_resource_group.main.name
}

# VNet ë§í¬
resource "azurerm_private_dns_zone_virtual_network_link" "main" {
  name                  = "vnet-link"
  resource_group_name   = azurerm_resource_group.main.name
  private_dns_zone_name = azurerm_private_dns_zone.main.name
  virtual_network_id    = azurerm_virtual_network.main.id
}

# DNS ë ˆì½”ë“œ
resource "azurerm_private_dns_a_record" "argocd" {
  name                = "argocd"
  zone_name           = azurerm_private_dns_zone.main.name
  resource_group_name = azurerm_resource_group.main.name
  ttl                 = 300
  records             = [azurerm_kubernetes_cluster.mgmt.private_fqdn]
}
```

---

## 7. ë°±ì—… ë° DR

### 7.1 Azure Backup for AKS

```hcl
# Recovery Services Vault
resource "azurerm_recovery_services_vault" "main" {
  name                = "rsv-k8s-backup"
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name
  sku                 = "Standard"

  soft_delete_enabled = true
}

# AKS Backup Extension
resource "azurerm_kubernetes_cluster_extension" "backup" {
  name           = "azure-aks-backup"
  cluster_id     = azurerm_kubernetes_cluster.mgmt.id
  extension_type = "Microsoft.DataProtection.Kubernetes"
}
```

### 7.2 Velero ì„¤ì • (ì„ íƒ)

```bash
# Velero ì„¤ì¹˜ (Azure Blob ë°±ì—”ë“œ)
velero install \
  --provider azure \
  --plugins velero/velero-plugin-for-microsoft-azure:v1.9.0 \
  --bucket velero-backups \
  --secret-file ./credentials-velero \
  --backup-location-config resourceGroup=rg-k8s-demo,storageAccount=stvelerobackups \
  --snapshot-location-config apiTimeout=5m,resourceGroup=rg-k8s-demo

# ë°±ì—… ìŠ¤ì¼€ì¤„ ìƒì„±
velero schedule create daily-backup --schedule="0 2 * * *"
```

---

## 8. ë³´ì•ˆ ì„¤ì •

### 8.0 ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ì›ì¹™

> **Private Cluster ê¶Œì¥**: ë…¸ë“œì— Public IPë¥¼ í• ë‹¹í•˜ì§€ ì•Šê³ , API ì„œë²„ë„ Private Endpointë¡œ ë…¸ì¶œ

```hcl
# AKS Private Cluster êµ¬ì„±
resource "azurerm_kubernetes_cluster" "main" {
  # ... ê¸°ì¡´ ì„¤ì • ...

  # Private Cluster (Public IP ë¯¸í• ë‹¹)
  private_cluster_enabled = true
  private_dns_zone_id     = azurerm_private_dns_zone.aks.id

  # API ì„œë²„ ì ‘ê·¼ ì œí•œ (ì„ íƒ)
  api_server_access_profile {
    authorized_ip_ranges = ["10.0.0.0/8"]  # VNet ë‚´ë¶€ë§Œ í—ˆìš©
  }
}

# Private DNS Zone for AKS
resource "azurerm_private_dns_zone" "aks" {
  name                = "privatelink.koreacentral.azmk8s.io"
  resource_group_name = azurerm_resource_group.main.name
}
```

| ë³´ì•ˆ ë ˆë²¨ | êµ¬ì„± | ì ‘ê·¼ ë°©ì‹ |
|----------|------|----------|
| **ì‹œì—°ìš© (ê¸°ë³¸)** | Public API + NSG ì œí•œ | ì¸í„°ë„·ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥ |
| **ìš´ì˜ìš© (ê¶Œì¥)** | Private Cluster | VPN/Bastion í†µí•´ì„œë§Œ ì ‘ê·¼ |

### 8.1 Azure AD ì—°ë™

```hcl
# AKS Azure AD í†µí•©
resource "azurerm_kubernetes_cluster" "main" {
  # ... ê¸°ì¡´ ì„¤ì • ...

  azure_active_directory_role_based_access_control {
    managed            = true
    azure_rbac_enabled = true
  }
}

# Azure AD ê·¸ë£¹ì— AKS ê´€ë¦¬ì ì—­í•  ë¶€ì—¬
resource "azurerm_role_assignment" "aks_admin" {
  scope                = azurerm_kubernetes_cluster.main.id
  role_definition_name = "Azure Kubernetes Service Cluster Admin Role"
  principal_id         = var.admin_group_object_id
}
```

### 8.2 ë„¤íŠ¸ì›Œí¬ ë³´ì•ˆ ê·¸ë£¹

```hcl
# NSG for AKS Subnet
resource "azurerm_network_security_group" "aks" {
  name                = "nsg-aks"
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name

  # HTTPS ì¸ë°”ìš´ë“œ í—ˆìš©
  security_rule {
    name                       = "AllowHTTPS"
    priority                   = 100
    direction                  = "Inbound"
    access                     = "Allow"
    protocol                   = "Tcp"
    source_port_range          = "*"
    destination_port_range     = "443"
    source_address_prefix      = "*"
    destination_address_prefix = "*"
  }

  # ë‚´ë¶€ í†µì‹  í—ˆìš©
  security_rule {
    name                       = "AllowVNetInbound"
    priority                   = 200
    direction                  = "Inbound"
    access                     = "Allow"
    protocol                   = "*"
    source_port_range          = "*"
    destination_port_range     = "*"
    source_address_prefix      = "VirtualNetwork"
    destination_address_prefix = "VirtualNetwork"
  }
}
```

### 8.3 Azure Policy ê±°ë²„ë„ŒìŠ¤

> AKSì— ëŒ€í•œ ì¡°ì§ ìˆ˜ì¤€ì˜ ì •ì±… ì ìš©

#### ê¸°ë³¸ ì •ì±… í• ë‹¹

```hcl
# Azure Policy for AKS í™œì„±í™”
resource "azurerm_kubernetes_cluster" "main" {
  # ... ê¸°ì¡´ ì„¤ì • ...

  azure_policy_enabled = true  # Azure Policy Add-on í™œì„±í™”
}

# ê¸°ë³¸ ì œê³µ ì •ì±… í• ë‹¹: K8s í´ëŸ¬ìŠ¤í„°ì—ëŠ” ê¶Œí•œ ìˆëŠ” ì»¨í…Œì´ë„ˆ í—ˆìš© ì•ˆ í•¨
resource "azurerm_resource_group_policy_assignment" "no_privileged" {
  name                 = "no-privileged-containers"
  resource_group_id    = azurerm_resource_group.main.id
  policy_definition_id = "/providers/Microsoft.Authorization/policyDefinitions/95edb821-ddaf-4404-9732-666045e056b4"

  parameters = jsonencode({
    effect = { value = "Deny" }
  })
}
```

#### ê¶Œì¥ ì •ì±… ëª©ë¡

| ì •ì±… | íš¨ê³¼ | ì„¤ëª… |
|-----|------|------|
| **ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ í—ˆìš© ëª©ë¡** | Deny | ìŠ¹ì¸ëœ ë ˆì§€ìŠ¤íŠ¸ë¦¬(ACR)ë§Œ í—ˆìš© |
| **ê¶Œí•œ ìˆëŠ” ì»¨í…Œì´ë„ˆ ê¸ˆì§€** | Deny | privileged: true ì°¨ë‹¨ |
| **í˜¸ìŠ¤íŠ¸ ë„¤íŠ¸ì›Œí¬ ê¸ˆì§€** | Deny | hostNetwork: true ì°¨ë‹¨ |
| **ë¦¬ì†ŒìŠ¤ ì œí•œ í•„ìˆ˜** | Audit | requests/limits ë¯¸ì„¤ì • ì‹œ ê²½ê³  |
| **ì½ê¸° ì „ìš© ë£¨íŠ¸ íŒŒì¼ì‹œìŠ¤í…œ** | Audit | readOnlyRootFilesystem ê¶Œì¥ |

#### íƒœê·¸ ì •ì±… (ë¦¬ì†ŒìŠ¤ ê´€ë¦¬)

```hcl
# í•„ìˆ˜ íƒœê·¸ ì •ì±…
resource "azurerm_resource_group_policy_assignment" "require_tags" {
  name                 = "require-cost-center-tag"
  resource_group_id    = azurerm_resource_group.main.id
  policy_definition_id = "/providers/Microsoft.Authorization/policyDefinitions/96670d01-0a4d-4649-9c89-2d3abc0a5025"

  parameters = jsonencode({
    tagName = { value = "CostCenter" }
  })
}

# ëª¨ë“  ë¦¬ì†ŒìŠ¤ì— ì ìš©í•  í‘œì¤€ íƒœê·¸
locals {
  standard_tags = {
    Environment = "demo"
    Project     = "k8s-multi-cluster"
    CostCenter  = "IT-Demo"
    Owner       = "platform-team"
    ManagedBy   = "terraform"
  }
}
```

#### ì •ì±… ì¤€ìˆ˜ ìƒíƒœ í™•ì¸

```bash
# AKS ì •ì±… ì¤€ìˆ˜ ìƒíƒœ í™•ì¸
az policy state list \
  --resource-group rg-k8s-demo \
  --filter "resourceType eq 'Microsoft.ContainerService/managedClusters'" \
  --query "[].{Policy:policyDefinitionName, State:complianceState}" \
  --output table

# ë¹„ì¤€ìˆ˜ ë¦¬ì†ŒìŠ¤ ìƒì„¸ ì¡°íšŒ
az policy state list \
  --resource-group rg-k8s-demo \
  --filter "complianceState eq 'NonCompliant'" \
  --output table
```

---

## 9. ë¹„ìš© ëª¨ë‹ˆí„°ë§

### 9.1 Azure Cost Management

```bash
# ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ë³„ ë¹„ìš© í™•ì¸
az consumption usage list \
  --start-date 2026-01-01 \
  --end-date 2026-01-31 \
  --query "[?contains(instanceId, 'rg-k8s-demo')]" \
  --output table

# ì˜ˆì‚° ì•Œë¦¼ ì„¤ì •
az consumption budget create \
  --budget-name k8s-demo-budget \
  --amount 100 \
  --time-grain Monthly \
  --category Cost \
  --resource-group rg-k8s-demo
```

### 9.2 ë¹„ìš© ì•Œë¦¼ ì„¤ì •

```hcl
# ì˜ˆì‚° ì•Œë¦¼
resource "azurerm_consumption_budget_resource_group" "main" {
  name              = "budget-k8s-demo"
  resource_group_id = azurerm_resource_group.main.id

  amount     = 100
  time_grain = "Monthly"

  time_period {
    start_date = "2026-01-01T00:00:00Z"
  }

  notification {
    enabled   = true
    threshold = 80.0
    operator  = "GreaterThan"

    contact_emails = ["admin@company.com"]
  }

  notification {
    enabled   = true
    threshold = 100.0
    operator  = "GreaterThan"

    contact_emails = ["admin@company.com"]
  }
}
```

---

## 10. ì²´í¬ë¦¬ìŠ¤íŠ¸

### 10.1 ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Azure êµ¬ë… ë° ê¶Œí•œ í™•ì¸
- [ ] ë¦¬ì†ŒìŠ¤ í• ë‹¹ëŸ‰ í™•ì¸ (Spot VM ì¿¼í„°)
- [ ] Terraform ìƒíƒœ ë°±ì—”ë“œ ì¤€ë¹„
- [ ] ë„¤íŠ¸ì›Œí¬ CIDR ê³„íš ê²€í† 
- [ ] ë¹„ìš© ì˜ˆì‚° ì„¤ì •

### 10.2 ë°°í¬ í›„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] AKS í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸
- [ ] ArgoCD ì ‘ê·¼ í™•ì¸
- [ ] Azure Monitor ë¡œê·¸ ìˆ˜ì§‘ í™•ì¸
- [ ] ë°±ì—… ì •ì±… í™œì„±í™”
- [ ] ë¹„ìš© ì•Œë¦¼ ì„¤ì •

### 10.3 ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Spot VM ì¤‘ë‹¨ ëŒ€ì‘ ê³„íš
- [ ] ë¹„ì—…ë¬´ì‹œê°„ ìë™ ìŠ¤ì¼€ì¼ë§ ì„¤ì •
- [ ] ì›”ê°„ ë¹„ìš© ë¦¬ë·°

---

## 11. ì—…ê·¸ë ˆì´ë“œ ì „ëµ

### 11.1 AKS ë²„ì „ ì—…ê·¸ë ˆì´ë“œ ì •ì±…

> AKSëŠ” Kubernetes ë²„ì „ N-2ê¹Œì§€ ì§€ì› (ì˜ˆ: 1.30 ì§€ì› ì‹œ 1.28 ì´ìƒ í•„ìš”)

#### ë²„ì „ í™•ì¸ ë° ê³„íš

```bash
# ì‚¬ìš© ê°€ëŠ¥í•œ ë²„ì „ í™•ì¸
az aks get-versions --location koreacentral --output table

# í˜„ì¬ í´ëŸ¬ìŠ¤í„° ë²„ì „ í™•ì¸
az aks show --resource-group rg-k8s-demo --name aks-mgmt --query kubernetesVersion

# ì‚¬ìš© ê°€ëŠ¥í•œ ì—…ê·¸ë ˆì´ë“œ ê²½ë¡œ í™•ì¸
az aks get-upgrades --resource-group rg-k8s-demo --name aks-mgmt --output table
```

#### ì—…ê·¸ë ˆì´ë“œ ì „ëµ ì„ íƒ

| ì „ëµ | ë°©ì‹ | ë‹¤ìš´íƒ€ì„ | ê¶Œì¥ í™˜ê²½ |
|-----|------|---------|----------|
| **In-place** | Control Plane â†’ Node Pool ìˆœì°¨ | ìµœì†Œ (Pod ì¬ìŠ¤ì¼€ì¤„ë§) | ì‹œì—°/ê°œë°œ |
| **Blue-Green** | ìƒˆ í´ëŸ¬ìŠ¤í„° ìƒì„± â†’ íŠ¸ë˜í”½ ì „í™˜ | ì—†ìŒ | í”„ë¡œë•ì…˜ |
| **Node Pool êµì²´** | ìƒˆ Node Pool ì¶”ê°€ â†’ ê¸°ì¡´ ì‚­ì œ | ìµœì†Œ | í”„ë¡œë•ì…˜ |

#### In-place ì—…ê·¸ë ˆì´ë“œ ì ˆì°¨ (ì‹œì—° í™˜ê²½)

```bash
#!/bin/bash
# scripts/azure/aks-upgrade.sh

RESOURCE_GROUP="rg-k8s-demo"
CLUSTER_NAME="aks-mgmt"
TARGET_VERSION="1.30.0"

echo "=== AKS ì—…ê·¸ë ˆì´ë“œ ì‹œì‘ ==="

# 1. í˜„ì¬ ìƒíƒœ í™•ì¸
echo "[1/5] í˜„ì¬ ë²„ì „ í™•ì¸..."
az aks show -g $RESOURCE_GROUP -n $CLUSTER_NAME --query kubernetesVersion -o tsv

# 2. Control Plane ì—…ê·¸ë ˆì´ë“œ
echo "[2/5] Control Plane ì—…ê·¸ë ˆì´ë“œ..."
az aks upgrade \
  --resource-group $RESOURCE_GROUP \
  --name $CLUSTER_NAME \
  --kubernetes-version $TARGET_VERSION \
  --control-plane-only \
  --yes

# 3. Node Pool ì—…ê·¸ë ˆì´ë“œ (ìˆœì°¨ì )
echo "[3/5] Node Pool ì—…ê·¸ë ˆì´ë“œ..."
for pool in $(az aks nodepool list -g $RESOURCE_GROUP --cluster-name $CLUSTER_NAME --query "[].name" -o tsv); do
  echo "  - Upgrading node pool: $pool"
  az aks nodepool upgrade \
    --resource-group $RESOURCE_GROUP \
    --cluster-name $CLUSTER_NAME \
    --name $pool \
    --kubernetes-version $TARGET_VERSION \
    --yes
done

# 4. í™•ì¸
echo "[4/5] ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ í™•ì¸..."
az aks show -g $RESOURCE_GROUP -n $CLUSTER_NAME --query kubernetesVersion -o tsv

# 5. ë…¸ë“œ ìƒíƒœ í™•ì¸
echo "[5/5] ë…¸ë“œ ìƒíƒœ í™•ì¸..."
kubectl get nodes -o wide

echo "=== ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ ==="
```

### 11.2 Node Image ì—…ê·¸ë ˆì´ë“œ

```bash
# Node Imageë§Œ ì—…ê·¸ë ˆì´ë“œ (OS íŒ¨ì¹˜, ë³´ì•ˆ ì—…ë°ì´íŠ¸)
az aks nodepool upgrade \
  --resource-group rg-k8s-demo \
  --cluster-name aks-mgmt \
  --name nodepool1 \
  --node-image-only

# ìë™ ì—…ê·¸ë ˆì´ë“œ ì±„ë„ ì„¤ì • (ê¶Œì¥)
az aks update \
  --resource-group rg-k8s-demo \
  --name aks-mgmt \
  --auto-upgrade-channel stable  # none, patch, stable, rapid, node-image
```

#### ìë™ ì—…ê·¸ë ˆì´ë“œ ì±„ë„ ë¹„êµ

| ì±„ë„ | ë™ì‘ | ê¶Œì¥ í™˜ê²½ |
|-----|------|----------|
| `none` | ìˆ˜ë™ ì—…ê·¸ë ˆì´ë“œë§Œ | ì—„ê²©í•œ ë³€ê²½ ê´€ë¦¬ í•„ìš” ì‹œ |
| `patch` | íŒ¨ì¹˜ ë²„ì „ ìë™ (1.30.0â†’1.30.1) | í”„ë¡œë•ì…˜ |
| `stable` | ë§ˆì´ë„ˆ ë²„ì „ê¹Œì§€ ìë™ (N-1) | ì‹œì—°/ê°œë°œ |
| `rapid` | ìµœì‹  ë²„ì „ ìë™ | í…ŒìŠ¤íŠ¸ í™˜ê²½ |
| `node-image` | OS ì´ë¯¸ì§€ë§Œ ìë™ | ëª¨ë“  í™˜ê²½ ê¶Œì¥ |

### 11.3 ì—…ê·¸ë ˆì´ë“œ ì‚¬ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

```bash
# ì—…ê·¸ë ˆì´ë“œ ì „ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
#!/bin/bash

echo "=== AKS ì—…ê·¸ë ˆì´ë“œ ì‚¬ì „ ì ê²€ ==="

# 1. Deprecated API ì‚¬ìš© í™•ì¸
echo "[1/4] Deprecated API í™•ì¸..."
kubectl get --raw /metrics | grep apiserver_requested_deprecated_apis

# 2. PDB í™•ì¸ (ì—…ê·¸ë ˆì´ë“œ ì¤‘ Pod ë³´í˜¸)
echo "[2/4] PodDisruptionBudget í™•ì¸..."
kubectl get pdb -A

# 3. ë¦¬ì†ŒìŠ¤ ì—¬ìœ  í™•ì¸
echo "[3/4] ë…¸ë“œ ë¦¬ì†ŒìŠ¤ í™•ì¸..."
kubectl top nodes

# 4. ë°±ì—… ìƒíƒœ í™•ì¸
echo "[4/4] Velero ë°±ì—… í™•ì¸..."
velero backup get | head -5

echo "=== ì ê²€ ì™„ë£Œ ==="
```

### 11.4 ë¡¤ë°± ì ˆì°¨

> âš ï¸ AKS Control Planeì€ ë¡¤ë°± ë¶ˆê°€. ë¬¸ì œ ë°œìƒ ì‹œ ìƒˆ í´ëŸ¬ìŠ¤í„° ìƒì„± í•„ìš”.

```bash
# Node Poolë§Œ ë¡¤ë°± ê°€ëŠ¥ (ìƒˆ Node Pool ìƒì„± ë°©ì‹)
az aks nodepool add \
  --resource-group rg-k8s-demo \
  --cluster-name aks-mgmt \
  --name rollbackpool \
  --kubernetes-version 1.29.0 \
  --node-count 2

# ì›Œí¬ë¡œë“œ ë§ˆì´ê·¸ë ˆì´ì…˜ í›„ ê¸°ì¡´ Node Pool ì‚­ì œ
kubectl cordon <old-nodes>
kubectl drain <old-nodes> --ignore-daemonsets --delete-emptydir-data
az aks nodepool delete --name <old-pool> ...
```

---

## ë¶€ë¡

### A. Azure CLI ìœ ìš©í•œ ëª…ë ¹ì–´

```bash
# ë¦¬ì†ŒìŠ¤ ê·¸ë£¹ ì „ì²´ ì‚­ì œ
az group delete -n rg-k8s-demo-dev --yes --no-wait

# AKS ë²„ì „ í™•ì¸
az aks get-versions -l koreacentral -o table

# Spot VM ê°€ê²© í™•ì¸
az vm list-skus -l koreacentral --size Standard_D2s_v3 -o table

# ë¦¬ì†ŒìŠ¤ ë¹„ìš© íƒœê·¸ ì¶”ê°€
az tag create --resource-id /subscriptions/.../resourceGroups/rg-k8s-demo --tags CostCenter=Demo
```

### B. ë¡œì»¬ â†” Azure ì „í™˜

```bash
# ë¡œì»¬ Multipass í™˜ê²½ ì‚¬ìš©
export KUBECONFIG=./kubeconfigs/mgmt.conf

# Azure AKS í™˜ê²½ ì‚¬ìš©
az aks get-credentials -g rg-k8s-demo -n aks-mgmt

# ì»¨í…ìŠ¤íŠ¸ ì „í™˜
kubectl config get-contexts
kubectl config use-context aks-mgmt
```

---

> **ë¬¸ì„œ ë²„ì „**: 1.1.0
> **ì‘ì„±ì**: ì¸í”„ë¼ íŒ€
> **ìµœì¢… ìˆ˜ì •ì¼**: 2026-02-05
> **ë³€ê²½ ì‚¬í•­**: ADR ì¶”ê°€ (Spot ë°°ì¹˜/CNI ì„ íƒ/ì¸ì¦ ì „í™˜/ê´€ì°°ì„±), ì„œë¹„ìŠ¤ ë§¤í•‘ ê¸°ëŠ¥ ì°¨ì´ ëª…ì‹œ, AKS í‹°ì–´ ì´ì›í™”
